<!DOCTYPE html>
<html>
<head>
  <title>Simple Blog</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; }
    input, textarea { width: 100%; margin: 5px 0; }
    .post { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; }
    .comments { margin-left: 20px; color: #444; }
  </style>
</head>
<body>

<h2>Register</h2>
<input id="reg-username" placeholder="Username">
<input id="reg-password" type="password" placeholder="Password">
<button onclick="register()">Register</button>

<h2>Login</h2>
<input id="login-username" placeholder="Username">
<input id="login-password" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<h2>Create Post</h2>
<input id="title" placeholder="Title">
<textarea id="content" placeholder="Content"></textarea>
<button onclick="createPost()">Post</button>

<h2>All Posts</h2>
<div id="posts"></div>

<script>
let currentUser = null;
const API = 'https://your-render-app-url.onrender.com'; // Change to your Render backend URL

function register() {
  fetch(`${API}/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      username: document.getElementById('reg-username').value,
      password: document.getElementById('reg-password').value
    })
  }).then(res => res.json()).then(alert);
}

function login() {
  const username = document.getElementById('login-username').value;
  const password = document.getElementById('login-password').value;
  fetch(`${API}/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  }).then(res => {
    if (res.ok) {
      currentUser = username;
      alert('Logged in as ' + username);
      loadPosts();
    } else {
      alert('Login failed');
    }
  });
}

function createPost() {
  if (!currentUser) return alert('Login first');
  fetch(`${API}/posts`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      title: document.getElementById('title').value,
      content: document.getElementById('content').value,
      username: currentUser
    })
  }).then(() => loadPosts());
}

function loadPosts() {
  fetch(`${API}/posts`)
    .then(res => res.json())
    .then(posts => {
      const container = document.getElementById('posts');
      container.innerHTML = '';
      posts.reverse().forEach(post => {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <strong>${post.title}</strong> by ${post.username}<br>
          ${post.content}<br>
          Likes: ${post.likes || 0}
          <button onclick="likePost('${post._id}')">Like</button>
          ${post.username === currentUser || currentUser === 'admin' ? `<button onclick="deletePost('${post._id}')">Delete</button>` : ''}
          <br>
          <input id="comment-${post._id}" placeholder="Add comment">
          <button onclick="addComment('${post._id}')">Comment</button>
          <div class="comments">
            ${post.comments.map(c => `â€¢ ${c}`).join('<br>')}
          </div>
        `;
        container.appendChild(div);
      });
    });
}

function likePost(id) {
  fetch(`${API}/posts/${id}/likes`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' }
  }).then(() => loadPosts());
}

function addComment(id) {
  const comment = document.getElementById(`comment-${id}`).value;
  fetch(`${API}/posts/${id}/comments`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ comment })
  }).then(() => loadPosts());
}

function deletePost(id) {
  fetch(`${API}/posts/${id}`, {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUser })
  }).then(() => loadPosts());
}

window.onload = loadPosts;
</script>

</body>
</html>
